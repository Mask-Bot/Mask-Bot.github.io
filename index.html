<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <title>Mask???</title>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        body {
            display: flex;
            flex-direction: column;
            background-color: #000;
            color: #fff;
            background-image: url('bg.jpg');
            background-size: cover;
            background-position: center;
            overflow: auto;
        }
        .content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
        }
        .coins {
            font-size: 30px;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            margin-top: -20px;
        }
        .navbar {
            display: flex;
            justify-content: space-around;
            background-color: #1a1a1a;
            color: #fff;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.5);
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 1000;
        }

        .navbar button {
            background-color: #333;
            color: #fff;
            border: none;
            padding: 15px;
            font-size: 4vw; /* –ò—Å–ø–æ–ª—å–∑—É–µ–º viewport width –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ */
            flex: 1;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
            margin: 0 1%; /* –ú–µ–Ω—å—à–∏–π –æ—Ç—Å—Ç—É–ø –¥–ª—è –ª—É—á—à–µ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ */
            border-radius: 5px;
            max-width: 30%; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –∫–Ω–æ–ø–æ–∫ */
        }

        .navbar button:hover {
            background-color: #555;
            transform: scale(1.05);
        }

        .navbar button:active {
            background-color: #777;
            transform: scale(0.95);
        }

        /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å –¥–ª—è –±–æ–ª–µ–µ –º–µ–ª–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 600px) {
            .navbar button {
                padding: 10px;
                font-size: 5vw; /* –ë–æ–ª—å—à–µ —à—Ä–∏—Ñ—Ç –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
                margin: 0 2%; /* –£–º–µ–Ω—å—à–∏—Ç—å –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-in-out;
        }
        .modal-content {
            background-color: #fff;
            color: #000;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            text-align: center;
            border-radius: 10px;
            animation: zoomIn 0.5s ease-in-out;
        }
        .modal-content h2 {
            margin: 0 0 20px;
        }
        .modal-content p {
            font-size: 20px;
            margin: 10px 0;
        }
        .modal-content button {
            background-color: #000;
            color: #fff;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }
        .modal-content button:hover {
            background-color: #444;
        }
        .leaderboard {
            text-align: center;
            margin-top: 2px;
            padding: 20px;
            border-radius: 10px;
            background: none; /* –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ */
        }
        .player-rank {
            background: rgba(255, 255, 255, 0); /* –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
            border: 3px solid white; /* –ó–æ–ª–æ—Ç–∞—è —Ä–∞–º–∫–∞ */
            color: #fff; /* –ß–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç */
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-size: 20px;
            position: relative; /* –î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–º–æ–¥–∑–∏ */
        }
        .player-rank p {
            margin: 0; /* –£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç—Å—Ç—É–ø–æ–≤ */
            font-size: 24px; /* –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            font-weight: bold; /* –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç */
        }
        .player-rank::before {
            content: 'üéØ'; /* –≠–º–æ–¥–∑–∏ –º–∏—à–µ–Ω–∏ */
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px; /* –†–∞–∑–º–µ—Ä —ç–º–æ–¥–∑–∏ */
        }
        .leaderboard-info {
            display: flex;
            justify-content: space-between; /* –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ */
            align-items: center; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            margin: 10px 0;
            font-size: 20px;
            width: 100%;
        }
        .leaderboard-info span {
            margin: 0 10px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
        }
        .leaderboard ul {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%; /* –†–∞—Å—Ç—è–Ω—É—Ç—å –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —ç–∫—Ä–∞–Ω–∞ */
            box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞—Ç—å padding –∏ border –≤ —à–∏—Ä–∏–Ω–µ —ç–ª–µ–º–µ–Ω—Ç–∞ */
        }
        .leaderboard li {
            background: rgba(255, 255, 255, 0.5); /* –ë–µ–ª—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
            color: #000; /* –ß–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç */
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            align-items: center;
            width: 90vw; /* –†–∞—Å—Ç—è–Ω—É—Ç—å –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —ç–∫—Ä–∞–Ω–∞ */
            box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞—Ç—å padding –∏ border –≤ —à–∏—Ä–∏–Ω–µ —ç–ª–µ–º–µ–Ω—Ç–∞ */
        }
        .leaderboard .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            text-transform: uppercase;
            margin-right: 10px;
        }
        .leaderboard li span {
            display: inline-block;
            width: auto; /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —à–∏—Ä–∏–Ω–∞ */
        }
        .leaderboard li span.rank {
            margin-right: 10px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –º–µ–¥–∞–ª—å–∫–æ–π –∏ –∞–≤–∞—Ç–∞—Ä–∫–æ–π */
        }
        .leaderboard li span:last-child {
            text-align: right;
            flex: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
        }
        .leaderboard li::before {
            margin-right: 10px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –Ω–æ–º–µ—Ä–æ–º –∏ –Ω–∏–∫–æ–º */
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease-in-out;
        }
        .modal-content {
            background-color: #fff;
            color: #000;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            text-align: center;
            border-radius: 10px;
            animation: zoomIn 0.5s ease-in-out;
        }
        .modal-content h2 {
            margin: 0 0 20px;
        }
        .modal-content p {
            font-size: 20px;
            margin: 10px 0;
        }
        .modal-content button {
            background-color: #000;
            color: #fff;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
        }
        .modal-content button:hover {
            background-color: #444;
        }


        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –ó–∞–¥–∞–Ω–∏—è */
        .tasks {
            text-align: center;
            margin-top: 20px;
            padding-bottom: 66px;
        }
        .task-block {
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            text-align: center;
            width: 90%;
            position:relative;
            border: 1px solid #ddd;
        }
        .task-block h3 {
            margin-top: 0;
            font-size: 22px;
            font-weight: bold;
        }
        .task {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
        }
        .task img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .task-button {
            padding: 10px 20px;
            font-size: 14px;
            background-color: #000;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            width: 100px; /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫*/
            text-align: center;
        }

        .task-button.completed {
            background-color: #414141;
            color: rgb(255, 255, 255);
            border: none;
            width: 60px; /* —Ç–∞ –∂–µ —à–∏—Ä–∏–Ω–∞, —á—Ç–æ –∏ —É –∫–Ω–æ–ø–∫–∏ */
            text-align: center;
        }

        .task-button:hover {
            background-color: #444;
        }

        .task-button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }



        .task .status {
            font-size: 18px;
            color: green;
        }
        .task .status.hidden {
            display: none;
        }
        .task .description {
            flex: 1;
            text-align: left;
            padding-left: 10px;
            font-size: 16px;
        }

        #static-timer {
            font-size: 48px;
            font-weight: bold;
            color: #333; /* –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ –∂–µ–ª–∞–µ–º—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
            text-align: center;
            margin-top: 15px;
        }


    </style>
</head>
<body>
    <!-- <div id="ton-connect"></div>
    <script>
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://mask-bot.github.io/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });
    </script> -->

    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <h2>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å</h2>
            <p>+0.00146 $MASKS</p>
            <button onclick="claimBonus()">–ü–æ–ª—É—á–∏—Ç—å</button>
        </div>
    </div>

    <div id="home-page">
        <div id="static-timer">00:00:00</div>
    </div>
    
    <div class="content" id="mainContent">
        <div class="leaderboard" id="leaderboard" style="display: none;">
            <h1>–õ–∏–¥–µ—Ä—ã</h1>
            <div class="player-rank">
                <p id="userRank">–¢–≤–æ–µ –º–µ—Å—Ç–æ: --</p>
            </div>
            <div class="leaderboard-info">
                <span id="userCount">0 –∏–≥—Ä–æ–∫–æ–≤</span>
                <span id="top10">(Top 10)</span>
            </div>
            <ul id="leaderboardList"></ul>
        </div>
        <div class="coins">0 $MASKS</div>
    </div>
    <div class="navbar">
        <button onclick="showHome()">
            <img src="home_icon.png" alt="home" style="width: 30px; height: 30px;">
        </button>
        <button onclick="showLeaderboard()">
            <img src="leaderboard_icon.png" alt="leaderboard" style="width: 30px; height: 30px;">
        </button>
        <button onclick="showTasks()">
            <img src="tasks_icon.png" alt="tasks" style="width: 30px; height: 30px;">
        </button>
        <button onclick="clearContent()">
            <img src="friends_icon.png" alt="friends" style="width: 30px; height: 30px;">
        </button>
        <button onclick="wallet()">
            <img src="wallet_icon.png" alt="wallet" style="width: 30px; height: 30px;">
        </button>
    </div>    

    <script async src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let coins = 0;
        let username = '';
        let leaderboard = [];
        let tasksCompleted = { /* –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á */ };
        

        window.onload = function() {
        Telegram.WebApp.ready();
        const user = Telegram.WebApp.initDataUnsafe.user;
        if (user) {
            username = user.username || user.first_name;
            const telegramId = user.id; // –ü–æ–ª—É—á–∞–µ–º Telegram ID
            const walletInfo = '';

            fetch('http://127.0.0.1:8000/add_player', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ telegram_id: telegramId, wallet_info: walletInfo })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data); // –õ–æ–≥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            })
            .catch(error => {
                console.error('Error:', error); // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
            });

        }
        loadProgress();
        loadLeaderboard();
        loadTasks();
        document.getElementById('welcomeModal').style.display = 'flex';
        Telegram.WebApp.expand(); // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
    }


        function claimBonus() {
            coins += 0.00146;
            document.getElementById('welcomeModal').style.display = 'none'; // –°–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            saveProgress();
            updateCoins();
        }

        function updateCoins() {
            document.querySelector('.coins').textContent = coins + ' $MASKS';
        }

        function clearContent() {
            document.getElementById('mainContent').innerHTML = '';
        }

        function showHome() {
            document.getElementById('mainContent').innerHTML = '<div class="coins">' + coins + ' $MASKS</div>';
            updateCoins();
        }

        function showLeaderboard() {
            updateLeaderboard();
            const totalUsers = leaderboard.length;
            document.getElementById('mainContent').innerHTML = 
                '<div class="leaderboard" id="leaderboard">' +
                    '<h1>–õ–∏–¥–µ—Ä—ã</h1>' +
                    '<div class="player-rank">' +
                        '<p id="userRank">–¢–≤–æ–µ –º–µ—Å—Ç–æ: --</p>' +
                    '</div>' +
                    '<div class="leaderboard-info">' +
                        '<span id="userCount">' + totalUsers + ' ' + getPlayersText(totalUsers) + '</span>' +
                        '<span id="top10">(–¢–æ–ø 10)</span>' +
                    '</div>' +
                    '<ul id="leaderboardList"></ul>' +
                '</div>';
            renderLeaderboard();
        }

        function updateLeaderboard() {
            fetch('http://127.0.0.1:8000/leaderboard') // URL –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–≤–æ–µ–º—É —Å–µ—Ä–≤–µ—Ä—É
                .then(response => response.json())
                .then(data => {
                    leaderboard = data.leaderboard; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –ª–∏–¥–µ—Ä–æ–≤
                    renderLeaderboard();
                })
                .catch(error => {
                    console.error('Error fetching leaderboard:', error);
                });
        }

        function renderLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = ''; // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ø–∏—Å–æ–∫

            leaderboard.forEach(player => {
                const listItem = document.createElement('li');
                listItem.textContent = `${player.username}: ${player.coins} $MASKS`; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –µ—Å—Ç—å –ø–æ–ª—è username –∏ coins
                leaderboardList.appendChild(listItem);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userRankElement = document.getElementById('userRank');
            const userIndex = leaderboard.findIndex(player => player.telegram_id === telegramId);
            userRankElement.textContent = `–¢–≤–æ–µ –º–µ—Å—Ç–æ: ${userIndex !== -1 ? userIndex + 1 : '--'}`;
        }

        const telegramId = Telegram.WebApp.initDataUnsafe.user.id; // –ü–æ–ª—É—á–∞–µ–º Telegram ID

        function showTasks() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á —Å —Å–µ—Ä–≤–µ—Ä–∞
            fetch('http://127.0.0.1:8000/tasks/' + telegramId) // URL –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–≤–æ–µ–º—É —Å–µ—Ä–≤–µ—Ä—É
                .then(response => response.json())
                .then(data => {
                    tasksCompleted = data.tasks; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏

                    const advertisers = [
                        {
                            name: '–†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—å 1',
                            tasks: [
                                { description: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ Telegram', link: 'https://t.me/your_channel_1', reward: '+0.00033 $MASKS' },
                                { description: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ Instagram', link: 'https://instagram.com/your_instagram', reward: '+0.00033 $MASKS' },
                                { description: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ YouTube', link: 'https://youtube.com/your_youtube_channel', reward: '+0.00033 $MASKS' }
                            ]
                        },
                        {
                            name: '–†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—å 2',
                            tasks: [
                                { description: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ Facebook', link: 'https://facebook.com/your_facebook_page', reward: '+0.00033 $MASKS' },
                                { description: '–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ Twitter', link: 'https://twitter.com/your_twitter', reward: '+0.00033 $MASKS' }
                            ]
                        }
                    ]; // –ú–∞—Å—Å–∏–≤ —Å —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è–º–∏

                    const tasksHTML = advertisers.map(advertiser => {
                        const tasks = advertiser.tasks.map(task => {
                            const isCompleted = tasksCompleted[task.description];
                            return `
                                <div class="task" style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <img src="https://via.placeholder.com/60" alt="Avatar" style="width: 60px; height: 60px; margin-right: 10px;">
                                    <div class="task-details" style="flex-grow: 1;">
                                        <div class="description" style="font-size: 14px; font-weight: bold;">${task.description}</div>
                                        <div class="reward" style="font-size: 14px; color: green; margin-top: 5px; font-weight: bold; text-align: left; margin-left: 10px;">${task.reward}</div>
                                    </div>
                                    ${isCompleted ? 
                                        `<div class="task-button completed">Done</div>` : 
                                        `<button id="button-${task.description}" class="task-button" onclick="completeTask('${task.description}', '${task.reward}')">Do</button>`
                                    }
                                </div>
                            `;
                        }).join('');
                        return `
                            <div class="task-block">
                                <h3>${advertiser.name}</h3>
                                ${tasks}
                            </div>
                        `;
                    }).join('');

                    document.getElementById('mainContent').innerHTML = `<div class="tasks">${tasksHTML}</div>`;
                })
                .catch(error => {
                    console.error('Error fetching tasks:', error);
                });
        }

        function completeTask(taskDescription, reward) {
            const button = document.getElementById(`button-${taskDescription}`);
            
            if (button.innerText === "Do") {
                button.innerText = "Check"; // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            } else if (button.innerText === "Check") {
                button.outerHTML = `<div class="task-button completed">Done</div>`; // –ó–∞–º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ "Done"
                if (!tasksCompleted[taskDescription]) {
                    tasksCompleted[taskDescription] = true; // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                    addMasksToBalance(reward); // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å

                    // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                    fetch('http://127.0.0.1:8000/complete_task', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ telegram_id: telegramId, task_description: taskDescription })
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Task status updated:', data);
                        saveTasks(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–¥–∞—á–∏
                    })
                    .catch(error => {
                        console.error('Error updating task status:', error);
                    });
                }
            }
        }


        function addMasksToBalance(reward) {
            const rewardValue = parseFloat(reward.match(/[\d\.]+/)[0]);
            coins += rewardValue; // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            saveProgress();
            updateCoins(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        }



        function saveTasks() {
            localStorage.setItem('tasksCompleted', JSON.stringify(tasksCompleted));
        }

        function loadTasks() {
            tasksCompleted = JSON.parse(localStorage.getItem('tasksCompleted')) || {};
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            Telegram.WebApp.ready();
            const user = Telegram.WebApp.initDataUnsafe.user;
            if (user) {
                username = user.username || user.first_name;
                const telegramId = user.id;
            }
            loadProgress();
            loadLeaderboard();
            loadTasks();
            showHome(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É "–î–æ–º–æ–π" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            Telegram.WebApp.expand(); // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function getPlayersText(count) {
            if (count === 1) {
                return '–∏–≥—Ä–æ–∫';
            } else if (count > 1 && count < 5) {
                return '–∏–≥—Ä–æ–∫–∞';
            } else {
                return '–∏–≥—Ä–æ–∫–æ–≤';
            }
        }

        function joinTelegramChannel(url) {
            window.open(url, '_blank');
            // –ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
            // –ü—Ä–∏–º–µ—Ä:
            // tasksCompleted[url] = true;
            // updateTaskStatuses();
        }

        function saveProgress() {
            fetch('http://127.0.0.1:8000/save_progress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ telegram_id: telegramId, coins: coins })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Progress saved:', data);
            })
            .catch(error => {
                console.error('Error saving progress:', error);
            });
        }


        function loadProgress() {
            fetch('http://127.0.0.1:8000/load_progress/' + telegramId)
                .then(response => response.json())
                .then(data => {
                    coins = data.coins || 0; // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–µ "coins"
                    updateCoins();
                })
                .catch(error => {
                    console.error('Error loading progress:', error);
                });
        }


        function saveLeaderboard() {
            fetch('http://127.0.0.1:8000/save_leaderboard', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ leaderboard: leaderboard })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Leaderboard saved:', data);
            })
            .catch(error => {
                console.error('Error saving leaderboard:', error);
            });
        }


        function loadLeaderboard() {
            fetch('http://127.0.0.1:8000/load_leaderboard')
                .then(response => response.json())
                .then(data => {
                    leaderboard = data.leaderboard || []; // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–µ "leaderboard"
                })
                .catch(error => {
                    console.error('Error loading leaderboard:', error);
                });
        }


        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
        const startTime = new Date('2024-10-06T12:15:00+03:00').getTime(); // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
        const timerDuration = 31 * 24 * 60 * 60 * 1000; // 31 –¥–µ–Ω—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        const endTime = startTime + timerDuration; // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è

        function updateTimer() {
            const now = new Date().getTime();
            const remainingTime = endTime - now;

            if (remainingTime < 0) {
                document.getElementById("static-timer").innerHTML = "–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ!";
                return; // –ó–∞–≤–µ—Ä—à–∞–µ–º, –µ—Å–ª–∏ –≤—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–Ω–∏, —á–∞—Å—ã, –º–∏–Ω—É—Ç—ã –∏ —Å–µ–∫—É–Ω–¥—ã
            const days = Math.floor(remainingTime / (1000 * 60 * 60 * 24));
            const hours = Math.floor((remainingTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));


            

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            document.getElementById("static-timer").innerHTML = 
                `${days}:${hours}:${minutes}`;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        setInterval(updateTimer, 1000);

        function wallet() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const savedWalletAddress = localStorage.getItem('walletAddress');
            const isWalletUnlocked = localStorage.getItem('isWalletUnlocked') === 'true';

            document.getElementById('mainContent').innerHTML = `
                <div style="width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <div id="ton-connect-button"></div>
                    <div id="walletAddress" style="margin-top: 20px; font-size: 1.2em;">
                        ${savedWalletAddress ? savedWalletAddress : "No wallet connected"}
                    </div>
                    <div id="walletInfo" style="display: ${isWalletUnlocked ? 'none' : 'block'}; margin-top: 10px; color: red; font-size: 0.9em;">
                        Your wallet is unavailable. To make it available, please perform a transaction of 0.5 TON.
                    </div>
                    <button id="unlockButton" style="margin-top: 15px; padding: 10px 20px; font-size: 1em; cursor: pointer;" class="${isWalletUnlocked ? 'unblocked' : 'blocked'}" ${isWalletUnlocked ? 'disabled' : ''}>
                        ${isWalletUnlocked ? 'Wallet Unlocked' : 'Unlock Wallet'}
                    </button>
                </div>
            `;

            const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://mask-bot.github.io/tonconnect-manifest.json',
                buttonRootId: 'ton-connect-button'
            });

            let walletAddress;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
            tonConnectUI.onStatusChange(async (wallet) => {
                if (wallet) {
                    walletAddress = wallet.account.address;
                    document.getElementById("walletAddress").textContent = walletAddress; // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
                    localStorage.setItem('walletAddress', walletAddress); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–µ—Å –≤ localStorage
                    document.getElementById("walletInfo").style.display = "block";
                    document.getElementById("unlockButton").disabled = false; // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
                }
            });

            // –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–æ—à–µ–ª—å–∫–∞
            async function unlockWallet() {
                try {
                    const tx = await tonConnectUI.sendTransaction({
                        validUntil: Math.floor(Date.now() / 1000) + 600, // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (10 –º–∏–Ω—É—Ç)
                        messages: [
                            {
                                address: 'UQASUrYVEDVBoioJjG5_af9nE4VzBQwlyxOWix0OWlNFlLia', // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞
                                amount: '100000000', // 0.5 TON (–≤ –Ω–∞–Ω–æ–∫–æ–∏–Ω–∞—Ö)
                                payload: '',
                            }
                        ]
                    });

                    alert('Transaction sent successfully!');
                    document.getElementById("unlockButton").textContent = "Wallet Unlocked";
                    document.getElementById("unlockButton").classList.replace("blocked", "unblocked");
                    document.getElementById("unlockButton").disabled = true; // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                    localStorage.setItem('isWalletUnlocked', 'true');
                } catch (error) {
                    alert('Error sending transaction: ' + error.message);
                }
            }

            // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫ –∫–Ω–æ–ø–∫–µ
            document.getElementById('unlockButton').onclick = unlockWallet;
        }
    </script>
</body>
</html>
